<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sikapa - Community Payments Platform</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <script src="js/auth.js"></script>
    <script>
        // Check authentication - redirect to login if not authenticated
        document.addEventListener('DOMContentLoaded', function() {
            if (!isUserLoggedIn()) {
                window.location.href = 'login.html';
            }
            // Update UI with user info and admin button if applicable
            updateAuthUI();
            
            // Fetch and display user balance
            fetchUserBalance();
        });

        // Fetch user balance from backend
        async function fetchUserBalance() {
            try {
                const userId = localStorage.getItem('userId') || localStorage.getItem('user_uid');
                const authToken = localStorage.getItem('authToken') || localStorage.getItem('auth_token');
                
                if (!userId) {
                    console.log('[Balance] No userId found in localStorage');
                    document.getElementById('balanceAmount').textContent = '0.00';
                    return;
                }

                const apiBase = window.location.hostname === 'localhost' 
                    ? 'http://localhost:3000/api'
                    : 'https://sikapa-bwxu.onrender.com/api';

                const response = await fetch(`${apiBase}/balance/user/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success && data.balance !== undefined) {
                    document.getElementById('balanceAmount').textContent = data.balance.toFixed(2);
                    console.log('[Balance] Updated balance to:', data.balance.toFixed(2));
                } else {
                    console.log('[Balance] Failed to fetch balance, showing 0.00');
                    document.getElementById('balanceAmount').textContent = '0.00';
                }
            } catch (error) {
                console.error('[Balance] Error fetching balance:', error);
                document.getElementById('balanceAmount').textContent = '0.00';
            }
        }

        // Refresh balance every 5 seconds
        setInterval(fetchUserBalance, 5000);
    </script>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">üíé SIKAPA</div>
            <ul class="nav-links">
                <li id="auth-link" class="auth-link"></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Welcome to Sikapa</h1>
            <p>Fast, secure community payments for everyone</p>
            
            <!-- Total Balance Display -->
            <div class="balance-display">
                <div class="balance-card">
                    <p class="balance-label">Total Balance</p>
                    <p class="balance-amount">‚Çµ <span id="balanceAmount">0.00</span></p>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="cta-button cashout-btn" onclick="window.location.href='cashout.html'">Deposit/ Cashout</button>
                <button class="cta-button withdraw-btn" onclick="window.location.href='withdraw.html'">Withdraw</button>
            </div>
        </div>
    </section>

    <!-- Business Roadmap Section -->
    <section class="business-roadmap">
        <h2>BUSINESS ROADMAP</h2>
        <div class="roadmap-container">
            <div class="roadmap-item">
                <div class="roadmap-number">1</div>
                <div class="roadmap-content">
                    <p>Deposit <span class="highlight">GH‚Çµ100</span> - Cashout <span class="highlight">GH‚Çµ600</span></p>
                </div>
            </div>
            <div class="roadmap-item">
                <div class="roadmap-number">2</div>
                <div class="roadmap-content">
                    <p>Deposit <span class="highlight">GH‚Çµ300</span> - Cashout <span class="highlight">GH‚Çµ1000</span></p>
                </div>
            </div>
            <div class="roadmap-item">
                <div class="roadmap-number">3</div>
                <div class="roadmap-content">
                    <p>Deposit <span class="highlight">GH‚Çµ500</span> - Cashout <span class="highlight">GH‚Çµ1800</span></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="features">
        <h2>Key Features</h2>
        <div class="features-grid">
            <div class="feature-card">
                <h3>üí≥ Instant Payments</h3>
                <p>Send and receive money instantly, 24/7</p>
            </div>
            <div class="feature-card">
                <h3>üîí Secure</h3>
                <p>Bank-grade security for your peace of mind</p>
            </div>
            <div class="feature-card">
                <h3>üí∞ Low Fees</h3>
                <p>Competitive rates for all transactions</p>
            </div>
            <div class="feature-card">
                <h3>üåç Global</h3>
                <p>Connect with communities worldwide</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2026 Sikapa. All rights reserved.</p>
    </footer>

    <script src="js/script.js"></script>
</body>
</html>
